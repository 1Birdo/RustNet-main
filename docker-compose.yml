version: '3.8'

services:
  rustnet-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: rustnet-server
    restart: unless-stopped
    ports:
      - "1420:1420"  # User connections
      - "7002:7002"  # Bot connections
    volumes:
      - ./server/config:/opt/rustnet/config
      - ./certs:/opt/rustnet/certs
    environment:
      - RUST_LOG=info
      - CERT_PATH=/opt/rustnet/certs/cert.pem
      - KEY_PATH=/opt/rustnet/certs/key.pem
    networks:
      - rustnet-network
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "1420"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  rustnet-network:
    driver: bridge
